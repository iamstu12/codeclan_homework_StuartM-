---
title: "Manual Model Development"
author: "Stuart McColl"
date: "07/01/2021"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part 1 

### Tidy up the data ready for regression

Load libraries and data:

```{r, message=FALSE, warning=FALSE}

library(car)
library(tidyverse)
library(modelr)
library(GGally)
library(relaimpo)
library(lm.beta)
library(fastDummies)

houses <- read_csv("data/kc_house_data.csv")

```

Check for any missing values:

```{r}

houses %>%
  summarise_all(funs(sum(is.na(.))))

```

Remove columns that are not useful:

```{r}

houses_clean <- houses %>% 
  dplyr::select(-c(date, id, sqft_living15, sqft_lot15, zipcode))

names(houses_clean)

```

Covert waterfront into a logical variable:

```{r}

houses_clean <- houses_clean %>% 
  mutate(waterfront = ifelse(waterfront == 1, T, F))

houses_clean

```

Convert 'yr_renovated' into a 'renovated' logical variable:

```{r}

houses_clean <- houses_clean %>% 
  mutate(renovated = ifelse(yr_renovated == 0, F, T)) %>% 
  dplyr::select(-yr_renovated)

houses_clean

```

'Condition' and 'Grade' are both categorical variables. To model the data accurately, it is important to create 'dummy variables' for both condition and grade, which are 'true' or 'false' only:

```{r}

houses_clean %>% 
  summarise(min_grade = min(grade), max_grade = max(grade),
            min_condition = min(condition), max_condition = max(condition))

```

```{r}

houses_dummy <- houses_clean %>%
  dummy_cols(select_columns = c("grade", "condition"), remove_first_dummy = T) %>% 
  dplyr::select(-c(condition, grade))

houses_dummy
  

```

# Part 2

### Check and remove aliased variables

```{r}

alias(lm(price ~ ., data = houses_dummy))

# alias = 'sqft_basement'

```


```{r}

houses_trim <- houses_dummy %>% 
  dplyr::select(-sqft_basement)

houses_trim

```

```{r}

alias(lm(price ~ ., data = houses_trim))

# no aliases found

```

# Part 3

### Regression Models

First predictor

```{r, message=FALSE, warning=FALSE}

houses_trim_numeric <- houses_trim %>%
  select_if(is.numeric)

houses_trim_nonnumeric <- houses_trim %>%
  select_if(function(x) !is.numeric(x))

houses_trim_nonnumeric$price <- houses_trim$price

ggpairs(houses_trim_numeric)
ggpairs(houses_trim_nonnumeric)

```

Model 1

Price ~ Bedrooms

```{r}

model1 <- lm(price ~ bedrooms, data = houses_trim)

model1

```

#### This  tells us that the predicted 'price' will increase by 121,716 for every extra bedroom.

Summary

```{r}

summary(model1)

```

#### This tells us that 9.5% of the variance in price is based on the number of bedrooms

Plot

```{r}

par(mfrow = c(2, 2)) 

plot(model1)

```


Model 2

Price ~ sqft_living

```{r}

model2 <- lm(price ~ sqft_living, data = houses_trim)

model2

```

#### This  tells us that the predicted 'price' will increase by 280.6 for every sqft.

Summary

```{r}

summary(model2)

```

#### This tells us that 49% of the variance in price is based on the sqft of living.

Plot

```{r}

par(mfrow = c(2, 2)) 

plot(model2)

```

Model 3

Price ~ Condition

```{r}

model3 <- lm(price ~ condition_2 + condition_3 + condition_4 + condition_5, data = houses_trim)

model3

```

#### This tells us that 'condition 5', increase the price the most.

Summary

```{r}

summary(model3)

```

#### This tells us that condition only accounts for 0.6% of the variance in price.

Plot

```{r}

par(mfrow = c(2, 2)) 

plot(model3)

````


Model 4

Price ~ Waterfront

```{r}

model4 <- lm(price ~ waterfront, data = houses_trim)

model4

```

```{r}

summary(model4)

```

Model 5

Price ~ bedrooms + sqft_living

```{r}

model5 <- lm(price ~ bedrooms + sqft_living, data = houses_trim)

summary(model5)

```

#### This tells us that bedrooms and sqft_living account for 50% of the variance in price.













